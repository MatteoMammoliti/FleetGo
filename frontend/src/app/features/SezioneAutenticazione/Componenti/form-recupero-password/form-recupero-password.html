<div class="flex justify-center items-center w-full p-20 fade-in">
  <div class="bg-white w-full max-w-sm p-8 rounded-xl shadow-lg border border-slate-100">
    <div class="text-center mb-6">
      <h2 class="text-2xl font-bold text-slate-800">
        @if (step === 1) { Recupero Password }
        @if (step === 2) { Verifica Codice }
        @if (step === 3) { Password Aggiornata }
      </h2>
      
      @if (step < 3) {
        <p class="text-slate-500 text-sm mt-1">
          @if (step === 1) { Inserisci la tua email per continuare. }
          @if (step === 2) { Inserisci il codice ricevuto e la nuova password. }
        </p>
      }
    </div>

    @if (errore || errorePadre) {
      <div class="bg-red-50 text-red-600 text-sm p-3 rounded-lg mb-4 text-center font-medium border border-red-600">
        {{ errore || errorePadre }}
      </div>
    }
    
    @if (messaggio) {
      <div class="bg-blue-50 text-blue-600 text-sm p-3 rounded-lg mb-4 text-center font-medium border border-blue-600">
        {{ messaggio }}
      </div>
    }

    @if (step < 3) {
      <form (ngSubmit)="onSubmit()" class="flex flex-col gap-4">

        @if (step === 1) {
          <div class="flex flex-col gap-1.5">
            <label class="text-sm font-semibold text-slate-700">Email</label>
            <input type="email" [(ngModel)]="email" name="email" placeholder="nome@azienda.it"
                   class="w-full px-4 py-2.5 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all">
          </div>
        }
        @if (step === 2) {
          <div class="flex flex-col gap-4">
            <div class="flex flex-col gap-1.5">
              <label class="text-sm font-semibold text-blu">Codice OTP</label>
              <input type="text" [(ngModel)]="otp" name="otp" placeholder="Es. 123456" maxlength="6"
                     class="w-full px-4 py-2.5 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all">
            </div>

            <div class="flex flex-col gap-1.5">
              <label class="text-sm font-semibold text-blu">Nuova Password</label>
              <input type="password" [(ngModel)]="nuovaPassword" name="nuovaPassword" placeholder="********"
                     class="w-full px-4 py-2.5 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all">
            </div>

            <div class="flex flex-col gap-1.5">
              <label class="text-sm font-semibold text-blu">Conferma Password</label>
              <input type="password" [(ngModel)]="confermaPassword" name="confermaPassword" placeholder="********"
                     class="w-full px-4 py-2.5 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all">
            </div>

            <button type="button" (click)="step = 1; reset()" class="text-xs text-blue-600 hover:underline text-left">
              Hai sbagliato email? Torna indietro
            </button>
          </div>
        }
        <button type="submit" [disabled]="loading" 
                class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 rounded-lg transition-all active:scale-95 disabled:opacity-70 disabled:cursor-not-allowed">
          @if (loading) {
            Attendi...
          } @else {
            <div>
            @if (step === 1) { Invia Codice 
            <i class="bi-send-fill"></i> }</div>
            <div>
            @if (step === 2) { Salva Password 
            <i class="bi-bookmark-check-fill"></i> }
            </div>
          }
        </button>
      </form>
    }

    @if (step === 3) {
      <div class="text-center flex flex-col gap-4">
        <div class="w-12 h-12 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto text-2xl">
          <i class="bi-check-lg"></i>
        </div>
        <p class="text-blu text-sm">
          Password aggiornata con successo!
        </p>
        <a routerLink="/login" 
           class="block w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 rounded-lg transition-all text-center no-underline">
          Torna al Login
          <i class="bi-box-arrow-in-left"></i>
        </a>
      </div>
    }

  </div>
</div>