<div class="recovery-container">

  <div class="card">
    <h2 *ngIf="step === 1">Inserisci l'email</h2>
    <h2 *ngIf="step === 2">Inserisci Codice</h2>
    <h2 *ngIf="step === 3">Nuova Password</h2>
    <h2 *ngIf="step === 4">Fatto!</h2>

    <div *ngIf="errore" class="alert error">
      {{ errore }}
    </div>

    <div *ngIf="messaggio" class="alert info">
      {{ messaggio }}
    </div>

    <form (ngSubmit)="onSubmit()" *ngIf="step < 4">

      <div *ngIf="step === 1" class="form-group">
        <p class="desc">Inserisci la tua email, ti invieremo un codice di verifica.</p>
        <label>Email</label>
        <input type="email" [(ngModel)]="email" name="email" placeholder="nome@esempio.it">
      </div>

      <div *ngIf="step === 2" class="form-group">
        <p class="desc">Controlla la tua posta e inserisci il codice a 6 cifre.</p>
        <label>Codice OTP</label>
        <input type="text" [(ngModel)]="otp" name="otp" placeholder="123456" maxlength="6" class="input-otp">

        <label>Nuova Password</label>
        <input type="password" [(ngModel)]="nuovaPassword" name="nuovaPassword" placeholder="********">

        <label>Conferma Password</label>
        <input type="password" [(ngModel)]="confermaPassword" name="confermaPassword" placeholder="********">

        <div class="resend-link">
          <a (click)="step = 1; reset()">Email sbagliata? Torna indietro</a>
        </div>
      </div>

      <button type="submit" [disabled]="loading" class="btn-primary">
        <span *ngIf="loading">Attendi...</span>
        <span *ngIf="!loading">
          {{ step === 1 ? 'Invia Codice' : (step === 2 ? 'Verifica Codice' : 'Salva Password') }}
        </span>
      </button>

    </form>

    <div *ngIf="step === 3" class="success-screen">
      <div class="icon-check">✔</div>
      <p>La tua password è stata aggiornata correttamente.</p>
      <button class="btn-secondary" routerLink="/login">Vai al Login</button>
    </div>

  </div>
</div>
