<div class="bg-white rounded-3xl p-8 md:p-10 shadow-sm border border-slate-100">

  <h2 class="text-xl font-bold text-blu mb-2">Affiliazione Aziendale</h2>
  <p class="text-testo-s text-sm mb-8">Gestisci la tua connessione con l'azienda per accedere alla flotta.</p>

  @if (aziendaUtente) {

    <div class="border border-slate-200 rounded-2xl p-6 flex flex-wrap md:flex-nowrap items-center justify-between gap-4">

      <div class="flex items-center gap-4">
        <div class="w-14 h-14 bg-slate-50 rounded-xl flex items-center justify-center text-slate-500 text-2xl border border-slate-100">
          <i class="bi bi-building"></i>
        </div>

        <div>
          <h3 class="font-bold text-lg text-blu">{{ aziendaUtente.nome }}</h3>

          <div class="flex items-center gap-2 mt-1">
            <span class="text-xs text-testo-s font-semibold uppercase tracking-wider">Stato:</span>

            @if (aziendaUtente.verified) {
              <span class="text-green-600 bg-green-50 px-2 py-0.5 rounded text-xs font-bold flex items-center gap-1">
                <i class="bi bi-check-circle-fill"></i> Verificato
              </span>
            } @else {
              <span class="text-amber-600 bg-amber-50 px-2 py-0.5 rounded text-xs font-bold flex items-center gap-1">
                <i class="bi bi-hourglass-split"></i> In attesa di approvazione
              </span>
            }
          </div>
        </div>
      </div>

      <button (click)="disconnetti()"
              class="text-red-500 bg-red-50 hover:bg-red-100 border border-red-100 font-semibold py-2 px-4 rounded-lg text-sm transition-colors">
        Disconnetti
      </button>

    </div>

    @if (!aziendaUtente.verified) {
      <div class="mt-4 p-4 bg-blue-50 text-azzurro rounded-xl text-sm flex gap-3 items-start">
        <i class="bi bi-info-circle-fill text-lg mt-0.5"></i>
        <p>La tua richiesta è stata inviata. Potrai prenotare i veicoli solo dopo che un amministratore avrà confermato la tua affiliazione.</p>
      </div>
    }

  } @else {

    <div class="bg-slate-50 rounded-2xl p-6 border border-slate-200">
      <h3 class="font-bold text-blu mb-4">Unisciti a un'organizzazione</h3>

      <div class="flex flex-col md:flex-row gap-4">

        <div class="flex-grow">
          <label class="block text-xs font-bold text-testo-s uppercase mb-2">Seleziona Azienda</label>
          <div class="relative">
            <select [(ngModel)]="aziendaSelezionataId"
                    class="w-full appearance-none bg-white border border-slate-300 text-blu rounded-xl px-4 py-3 pr-8 focus:outline-none focus:border-azzurro focus:ring-1 focus:ring-azzurro">
              <option [ngValue]="null" disabled selected>-- Scegli un'azienda --</option>
              @for (az of aziendeDisponibili; track az.id) {
                <option [value]="az.id">{{ az.nome }}</option>
              }
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
              <i class="bi bi-chevron-down text-xs"></i>
            </div>
          </div>
        </div>

        <div class="flex items-end">
          <button (click)="inviaRichiesta()"
                  [disabled]="!aziendaSelezionataId"
                  [ngClass]="!aziendaSelezionataId ? 'opacity-50 cursor-not-allowed bg-slate-300' : 'bg-blu hover:bg-slate-800'"
                  class="w-full md:w-auto text-white font-bold py-3 px-6 rounded-xl transition-colors h-[48px]">
            Richiedi Affiliazione
          </button>
        </div>
      </div>

      <p class="text-xs text-slate-400 mt-4">
        Inserendo la richiesta verrà inviata una notifica all'admin della nuova azienda per la verifica.
      </p>
    </div>

  }

</div>
