<app-template-finestra-modale titolo="Dettagli Veicolo"
                              sottotitolo="Gestisci da qui il tuo veicolo!"
                              (chiudi)="chiudiModale()"
                              tastoBlu="Salva"
                              tastoBianco="chiudi"
                              (conferma)="salva()"
                              (annulla)="chiudiModale()">

  @if (veicolo == null) {
    <div class="contenitore-caricamento">
      <i class="caricamento bi bi-arrow-clockwise"></i>
    </div>
  } @else {
    <div class="contenitore-dettagli animazione-fade-down">

      <div class="wrapper-targa">
        <span class="badge-targa">{{ veicolo.targaVeicolo }}</span>
      </div>

      <div class="layout-principale">

        <div class="sezione-media">
          <div class="card-immagine">
            <img [src]="veicolo.urlImmagine || 'assets/images/placeholder-car.png'"
                 class="immagine-veicolo"
                 alt="Immagine Veicolo">
          </div>

          @if (veicolo.luogoRitiroDeposito?.latitudine && veicolo.luogoRitiroDeposito?.longitudine) {
            <div class="gruppo-mappa">
              <label class="etichetta">Posizione Attuale</label>
              <div class="contenitore-mappa">
                <div id="google-map" class="mappa"></div>
              </div>
              <p class="indirizzo-testo">
                <i class="bi-geo-alt-fill icona-blu"></i>
                {{ veicolo.luogoRitiroDeposito.nomeLuogo }}
              </p>
            </div>
          }
        </div>

        <div class="sezione-assegnazione">
          <div class="intestazione-assegnazione">
            <label class="etichetta-piccola">Azienda Assegnata</label>
            @if (veicolo.nomeAziendaAffiliata && !dissociaSelezionata) {
              <button (click)="dissociaSelezionata=true; this.aziendaSelezionata=null"
                      type="button"
                      class="bottone-dissocia">
                DISSOCIA AZIENDA
              </button>
            }
          </div>

          @if (veicolo.nomeAziendaAffiliata && !this.dissociaSelezionata) {
            <div class="badge-azienda-assegnata">
              {{ veicolo.nomeAziendaAffiliata }}
              <i class="bi-building icona-badge"></i>
            </div>
          } @else if (!veicolo.inManutenzione) {
            <div class="animazione-fade">
              <app-scelta-tendina
                [lista]="aziende"
                [chiaveVisuale]="'nomeAzienda'"
                [placeholder]="'Seleziona azienda per il trasferimento'"
                (valoreChange)="aziendaSelezionata = $event">
              </app-scelta-tendina>
            </div>
          } @else {
            <div class="avviso-manutenzione">
              Il veicolo è in manutenzione e non può essere assegnato.
            </div>
          }
        </div>

        <div class="griglia-info-tecniche">
          <div class="gruppo-input">
            <label class="etichetta-piccola">Modello</label>
            <div class="campo-sola-lettura">
              {{ veicolo.nomeModello }}
            </div>
          </div>

          <div class="gruppo-input">
            <label class="etichetta-piccola">Alimentazione</label>
            <div class="campo-sola-lettura">
              {{ veicolo.tipoDistribuzioneVeicolo }}
            </div>
          </div>
        </div>

      </div>
    </div>
  }

</app-template-finestra-modale>
