<app-template-finestra-modale titolo="Dettagli Veicolo" sottotitolo="Gestisci da qui il tuo veicolo!" (chiudi)="chiudiModale()" tastoBlu="Salva" tastoBianco="chiudi" (conferma)="salva()" (annulla)="chiudiModale()">
  @if (veicolo==null) {
    <div class="flex items-center justify-center h-[450px]">
      <i class="caricamento bi bi-arrow-clockwise"></i>
    </div>
  } @else {
    <div class="animate-fade-down">
    <div class="ml-3 py-2 ">
      <span class="uppercase bg-gray-100 px-4 py-1 rounded-xl text-gray-700 ">{{veicolo.targaVeicolo}}</span>
    </div>
      <div class="grid grid-cols-1 gap-4 px-3 ">
        <div class="flex flex-col gap-3">
          <div class="bg-white p-2 rounded-2xl shadow-sm border border-slate-200">
            <img [src]="veicolo.urlImmagine || 'assets/images/placeholder-car.png'"
                 class="w-full h-44 object-cover rounded-xl"
                 alt="Immagine Veicolo">
          </div>

          @if (veicolo.luogoRitiroDeposito?.latitudine && veicolo.luogoRitiroDeposito?.longitudine) {
            <div class="flex flex-col gap-2">
              <label class="text-sm font-semibold text-slate-700 ml-1">Posizione Attuale</label>
              <div class="w-full h-72 rounded-2xl overflow-hidden shadow-sm border border-slate-200 relative">
                <div id="google-map" class="w-full h-full"></div>
              </div>
              <p class="text-xs text-slate-500 ml-1 flex items-center gap-1">
                <i class="bi-geo-alt-fill text-blue-600"></i>
                {{ veicolo.luogoRitiroDeposito.nomeLuogo }}
              </p>
            </div>
          }
        </div>

            <div class="flex flex-col ">
              <div class="flex justify-between items-center">
                <label class="text-xs font-semibold text-gray-600 uppercase">Azienda Assegnata</label>
                @if (veicolo.nomeAziendaAffiliata && !dissociaSelezionata) {
                  <button (click)="dissociaSelezionata=true; this.aziendaSelezionata=null" type="button"
                          class="text-xs px-3 py-1  hover:text-red-700 hover:bg-red-100 mb-1 mt-2 rounded-xl bg-gray-100 text-gray-600 font-bold transition-all">
                    DISSOCIA AZIENDA
                  </button>
                }
              </div>

              @if (veicolo.nomeAziendaAffiliata && !this.dissociaSelezionata) {
                <div class="w-full px-4 py-3 rounded-xl bg-blue-50 border border-blue-100 text-blue-800 font-bold flex items-center justify-between">
                  {{ veicolo.nomeAziendaAffiliata }}
                  <i class="bi-building text-blue-300"></i>
                </div>
              } @else if(veicolo.inManutenzione) {
                <div class="fade-in">
                  <app-scelta-tendina
                    [lista]="aziende"
                    [chiaveVisuale]="'nomeAzienda'"
                    [placeholder]="'Seleziona azienda per il trasferimento'"
                    (valoreChange)="aziendaSelezionata = $event">
                  </app-scelta-tendina>
                </div>
              } @else {
                <div class="p-4 mt-3 bg-blue-50 border border-blue-100 rounded-xl text-slate-500 text-sm ">
                  Il veicolo è in manutenzione e non può essere assegnato.
                </div>
              }
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 pb-4">
              <div class="flex flex-col gap-2">
                <label class="text-xs font-semibold text-gray-600 uppercase">Modello</label>
                <div class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-100 text-slate-700 font-medium">
                  {{ veicolo.nomeModello }}
                </div>
              </div>

              <div class="flex flex-col gap-2">
                <label class="text-xs font-semibold text-gray-600 uppercase">Alimentazione</label>
                <div class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-100 text-slate-700 font-medium">
                  {{ veicolo.tipoDistribuzioneVeicolo }}
                </div>
              </div>
            </div>
        </div>
    </div>
  }

</app-template-finestra-modale>


