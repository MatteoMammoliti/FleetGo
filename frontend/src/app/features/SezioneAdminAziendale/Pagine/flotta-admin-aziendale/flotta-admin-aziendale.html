<app-template-titolo-sottotitolo titolo="Flotta Aziendale" sottotitolo="GESTISCI LA TUA FLOTTA AZIENDALE">

  <div class="h-[750px] flex flex-col overflow-hidden px-1">

    <div class="flex flex-col gap-6 h-full animate-fade-up animate-duration-1000">

      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white px-5 py-4 rounded-2xl shadow-sm border border-slate-100 shrink-0">
        <div class="flex flex-col gap-2">
          <div class="flex flex-wrap gap-3 text-sm bg-azzurro-scuro text-gray-100 p-2.5 rounded-xl">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.5)]"></span>
              <span class="font-bold">{{ getConteggio('DISPONIBILE') }}</span> Disponibili
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-yellow-400 shadow-[0_0_8px_rgba(250,204,21,0.5)]"></span>
              <span class="font-bold">{{ getConteggio('MANUTENZIONE') }}</span> Manutenzione
            </div>
            <div class="flex items-center gap-2 border-l border-white/20 pl-3">
              <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse shadow-[0_0_8px_rgba(239,68,68,0.5)]"></span>
              <span class="font-bold">{{ getConteggio('SENZALUOGO') }}</span> Senza luogo
            </div>
          </div>
        </div>

        <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
          <div class="relative w-full md:w-64">
            <app-input-checked
              [titolo]="'Cerca'"
              [placeholder]="'Cerca targa o modello...'"
              [(valore)]="testoRicerca"
              (valoreChange)="testoRicerca = $event">
            </app-input-checked>
          </div>

          <div class="relative w-full md:w-48">
            <app-scelta-tendina
              [titolo]="'Filtra Stato'"
              [placeholder]="'Tutti gli stati'"
              [lista]="['DISPONIBILE', 'MANUTENZIONE', 'SENZALUOGO']"
              [(valore)]="filtroStato"
              (valoreChange)="filtroStato = $event">
            </app-scelta-tendina>
          </div>
        </div>
      </div>

      <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar">

        @if (veicoli === null) {
          <div class="flex flex-col items-center justify-center py-32">
            <div class="relative">
              <i class="bi bi-arrow-clockwise text-5xl text-azzurro animate-spin inline-block"></i>
            </div>
            <p class="text-slate-400 mt-4 font-bold animate-pulse tracking-widest text-xs uppercase">Sincronizzazione Criffix...</p>
          </div>
        } @else {

          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-10">
            @for (veicolo of veicoliFiltrati; track veicolo.targaVeicolo) {
              <app-card-auto-aziendale
                [veicolo]="veicolo"
                (apriDettagli)="apriModaleDettagli($event)">
              </app-card-auto-aziendale>
            }

            @if (veicoliFiltrati?.length === 0) {
              <div class="col-span-full py-20 text-center animate-fade">
                <app-messaggio-card-vuota icona="bi-search" testoPrimario="Nessun veicolo trovato" testoSecondario="Prova a cambiare i filtri di ricerca."></app-messaggio-card-vuota>
              </div>
            }
          </div>
        }
      </div>
    </div>
  </div>

  @if (mostraModale) {
    <app-modale-gestisci-veicolo
      (inviaLuogo)="impostaLuogo($event)"
      (richiediVeicolo)="caricaDettagliVeicolo($event)"
      [loading]="loading"
      [veicoloInput]="veicoloSelezionato"
      [listaLuoghi]="listaLuoghi"
      (chiudi)="chiudiModale()">
    </app-modale-gestisci-veicolo>
  }
</app-template-titolo-sottotitolo>

@if (erroreBanner) {
  <app-banner-errore [errore]="erroreBanner" (chiudi)="erroreBanner=''"></app-banner-errore>
}
@if(successoBanner){
  <app-banner-errore [successo]="successoBanner" (chiudi)="successoBanner=''"></app-banner-errore>
}
