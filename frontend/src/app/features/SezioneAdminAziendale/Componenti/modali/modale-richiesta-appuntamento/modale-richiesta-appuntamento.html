<div class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-opacity duration-300 animate-fade animate-duration-300"
     [class.animate-fade-out]="chiusuraInCorso"
     (click)="chiudiModale()">

  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden flex flex-col md:flex-row relative animate-once animate-duration-300"
       [class.animate-jump-in]="!chiusuraInCorso"
       [class.animate-jump-out]="chiusuraInCorso"
       (click)="$event.stopPropagation()">

    <button (click)="chiudiModale()"
            class="absolute top-4 right-4 z-20 w-8 h-8 rounded-full bg-white/90 hover:bg-red-50 hover:text-red-500 shadow-sm flex items-center justify-center text-slate-500 transition-all active:scale-90">
      <i class="bi bi-x-lg text-sm"></i>
    </button>

    <div class="w-full md:w-2/3 relative h-64 md:h-auto bg-slate-100 group overflow-hidden flex items-center justify-center">
      @if(offertaSelezionata) {
        <img [src]="offertaSelezionata.immagineCopertina || 'assets/images/placeholder-car.jpg'"
             alt="Offerta" class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">

        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent md:hidden"></div>

        <div class="absolute top-6 left-6 bg-azzurro text-white px-3 py-1 rounded-lg font-black text-lg shadow-xl rotate-[-5deg] border-2 border-white/20 animate-bounce animate-infinite animate-duration-[3000ms]">
          -{{ offertaSelezionata.percentualeSconto }}%
        </div>
      } @else {
        <div class="absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900 flex flex-col items-center justify-center text-white p-6 text-center">
          <div class="w-20 h-20 bg-white/10 rounded-full flex items-center justify-center mb-4 backdrop-blur-sm">
            <i class="bi bi-headset text-4xl text-blue-400"></i>
          </div>
          <h3 class="text-xl font-bold text-white mb-2">Supporto FleetGo</h3>
          <p class="text-slate-400 text-sm">Siamo qui per aiutarti a risolvere qualsiasi problema.</p>
        </div>
      }
    </div>

    <div class="w-full md:w-1/2 p-8 md:p-10 flex flex-col bg-white">
      <div class="mb-6">
        @if(offertaSelezionata) {
          <div class="inline-flex items-center gap-2 text-azzurro bg-blue-50 px-3 py-1.5 rounded-lg text-sm font-bold border border-azzurro/20">
            <i class="bi bi-calendar-check"></i>
            <span>Scade il: {{ offertaSelezionata.scadenza | date:'dd/MM/yyyy' }}</span>
          </div>
        } @else {
          <div class="inline-flex items-center gap-2 text-amber-600 bg-amber-50 px-3 py-1.5 rounded-lg text-sm font-bold border border-amber-200">
            <i class="bi bi-lightning-charge-fill"></i>
            <span>Richiesta Prioritaria</span>
          </div>
        }
      </div>

      <div class="flex-grow overflow-y-auto max-h-[300px] pr-2 custom-scrollbar">
        @if(offertaSelezionata) {
          <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-3">Dettagli Promozione</h3>
          <p class="text-slate-600 leading-relaxed">{{ offertaSelezionata.descrizioneOfferta }}</p>
        } @else {
          <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-3">{{ titoloGenerico }}</h3>
          <p class="text-slate-600 leading-relaxed">{{ descrizioneGenerica }}</p>
        }
      </div>

      <div class="mt-8 pt-6 border-t border-slate-100">
        @if(appuntamentoRichiesto) {
          <div class="bg-green-50 text-green-700 p-4 rounded-2xl flex items-center justify-center gap-3 border border-green-100 animate-jump-in">
            <i class="bi bi-check-circle-fill text-2xl"></i>
            <span class="font-bold">Richiesta inviata con successo!</span>
          </div>
        } @else {
          <div class="flex flex-col gap-4">
            <button (click)="confermaModale()"
                    [disabled]="caricamentoInCorso"
                    class="w-full py-4 rounded-2xl bg-azzurro-scuro text-white font-bold text-lg hover:bg-blue-700 transition-all shadow-lg hover:shadow-blue-500/30 flex items-center justify-center gap-3 disabled:opacity-70 active:scale-[0.98]">

              @if(caricamentoInCorso) {
                <span class="w-6 h-6 border-3 border-white/30 border-t-white rounded-full animate-spin"></span>
                <span>Elaborazione...</span>
              } @else {
                <span>Prenota Contatto</span>
                <i class="bi bi-arrow-right text-xl"></i>
              }
            </button>
            <p class="text-center text-slate-400 text-[10px] uppercase tracking-widest font-bold">
              Nessun costo aggiuntivo per la consulenza
            </p>
          </div>
        }
      </div>
    </div>
  </div>
</div>
